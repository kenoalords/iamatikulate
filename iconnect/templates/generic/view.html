{% extends '../app_base.html' %}

{% load static humanize %}

{% block metatags %}
    {% include 'parts/metatags.html' with description=post.text url=post.link title=post.fullname %}
{% endblock metatags %}

{% block content %}
    <div id="map-single" data-latitude="{{ post.latitude }}"  data-longitude="{{ post.longitude }}" data-text="{{ post.text }}" data-fullname="{{ post.user.first_name }} {{ post.user.last_name }}" data-image={{ post.user.profile.profile_image }}></div>

    <div class="section single-post">
        <div class="container">
            <div class="columns is-centered">
                <div class="column is-8">
                    {% include '../parts/post.html' with post=post %}

                    {% if request.user.is_authenticated %}
                        <div class="box comment">
                            <form action="{% url 'iconnect:view' uuid=post.uuid %}" method="post" class="comment-form">
                                {% csrf_token %}
                                <div class="field">
                                    {{ comment_form.text }}
                                </div>
                                <div class="field">
                                    <button class="is-info button is-rounded comment-submit" type="submit">
                                        <span class="icon"><i class="fab fa-telegram-plane"></i></span>
                                        <span>Submit</span>
                                    </button>
                                    <button type="reset" class="button is-white" style="opacity: .3">Reset</button>
                                </div>
                            </form>
                        </div>
                    {% endif %}

                    <h2 class="title is-5"><span class="comment-count">{{ comments.count }}</span> Response{{ comments.count|pluralize }}</h2>
                    <div id="comments">
                        {% if comments %}
                            {% for comment in comments %}
                                <div class="comment box">
                                    <div class="meta">
                                        {% if comment.user.profile %}
                                            <a href="{% url 'iconnect:view' uuid=post.uuid %}"><figure class="image avatar is-24x24" style="background: url({{ comment.user.profile.profile_image }}) no-repeat center; background-size:cover"></figure></a>
                                        {% else %}
                                            <a href="{% url 'iconnect:view' uuid=post.uuid %}"><figure class="image avatar is-24x24" style="background: url({% static 'images/user.svg' %}) no-repeat center; background-size:cover"></figure></a>
                                        {% endif %}
                                        <div>
                                            <h4 class="title is-6 is-marginless">{{ comment.fullname }}</h4>
                                        </div>
                                    </div>
                                    <!-- <h4 class="title is-7">{{ comment.fullname }}</h4> -->
                                    <p>{{ comment.text }}</p>
                                    <div class="level is-mobile">
                                        <div class="level-left">
                                            <div class="level-item">
                                                <form action="{% url 'iconnect:like-comment' %}" method="post">
                                                    {% csrf_token %}
                                                    <input type="hidden" name="comment" class="comment-id" value="{{ comment.id }}">
                                                    <input type="hidden" name="next" value="{{ request.path }}">
                                                    <button type="submit" class="like-comment is-small">
                                                        <span class="icon"><i class="fas fa-heart"></i></span>
                                                        <span><span class="like-count">{{ comment.likes }}</span> Like</span>
                                                    </button>
                                                </form>
                                            </div>
                                        </div>
                                        <div class="level-right">
                                            <div class="level-item">
                                                <span class="date">{{ comment.date|naturaltime }}</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            {% endfor %}
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% if other_posts %}
    <hr>
    <div class="hero">
        <div class="hero-body">
            <div class="container">
                <div class="columns is-centered">
                    <div class="column is-8">
                        <h4 class="title is-4">More posts in <a href="{% url 'iconnect:explore' %}?category={{ category.slug }}&cat_id={{ category.id }}">{{ category.title }}</a></h4>
                        {% for post in other_posts %}
                            {% include '../parts/post.html' with post=post %}
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% endif %}

    <div class="modal explore-modal">
        <div class="modal-background"></div>
        <div class="modal-content">
            <div class="box">
                <div class="share-images">
                    <img src="{% static 'images/modal-logo.jpg' %}" alt="Share with friends">
                </div>
                <div class="has-text-centered">
                    <h3 class="title is-5">Help us share this website with your friends on social media</h3>
                    <p>We are counting on you. Thanks!</p>
                    <hr>
                    <a href="https://www.facebook.com/sharer/sharer.php?u=https://{{ request.get_host }}{% url 'iconnect:explore' %}" target="_blank" class="facebook social-modal-links"><span class="icon"><i class="fab fa-facebook"></i></span></a>
                    <a href="https://twitter.com/intent/tweet?text=Join the conversation on www.iamatikulate.com and share your ideas for a greater Nigeria. Sign up today! &url=https://{{ request.get_host }}{% url 'iconnect:explore' %}&hashtags=iamatikulate" target="_blank" class="twitter social-modal-links"><span class="icon"><i class="fab fa-twitter"></i></span></a>
                    <a href="https://plus.google.com/share?url=https://{{ request.get_host }}{% url 'iconnect:explore' %}" target="_blank" class="google-plus social-modal-links"><span class="icon"><i class="fab fa-google-plus"></i></span></a>
                </div>
            </div>
        </div>
        <button class="modal-close" aria-label="close"></button>
    </div>
{% endblock content %}
